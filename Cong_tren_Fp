#include <stdio.h>
#include <math.h>
int x, e;
int w, m, c[50], A[50], B[50];
long long p, t, a, b;
void nhap()
{
    printf("\nNhap p: ");
    scanf("%lld", &p);
    printf("Nhap w: ");
    scanf("%d", &w);
    printf("\nNhap a: ");
    scanf("%lld", &a);
    printf("Nhap b: ");
    scanf("%lld", &b);
    
   
}
int bieudien(int x,int mang[50])
{
    m = log(p) / log(2) + 1;
    t = (m / w)+1; 
    for(int i=0;i<t;i++){
        int tmp=pow(2,(t-1-i)*w);
        mang[i]= x / tmp;
        x=x%tmp;
        printf("%5d ",mang[i]);
    }
}
void CongChinhXacBoi()
{ // tim (Ep,c)
    printf("\nma tra cua A: ");
    bieudien(a,A);
    printf("\nma tra cua B: ");
    bieudien(b,B);
    e = 0; // epsilo
    int tmp = pow(2, w);
    printf("\nc:");
    for (int i = t - 1; i >= 0; i--)
    {
        c[i] = A[i] + B[i] + e;
        if (c[i] > tmp)
        {
            c[i] = c[i] - tmp;
            e = 1;
        }
        else
        {
            e = 0;
        }
    }
    for (int i = 0; i < t; i++)
    {
        printf("%d  ", c[i]);
    }
    printf("\t Voi e=%d", e);
}
void tinh(){
    // xet e để tìm c cuối
    long long x = 0; //  x la gia tri c khi chuyen ve so nguyen
                     // chuyển c từ mảng về số tự nhiên để so sánh với p
    for (int i = 0; i < t; i++)
    {
        x = x + c[i] * pow(2, w * (t - 1 - i));
    }

    if (e == 1 || e == 0)
    {
        if (x >= p)
        {
            // so sanh c vs p de tim ra c' cuoi duoi' dang. mang? nhi. phan
            int cNew, CNEW[50];
            cNew = x - p;
            printf(" \nc' = %d ", cNew);
            printf(" \nC' :  ");
            bieudien(cNew,CNEW);
        }
    }
    
    else if(e==0 && x<p )
    {
        printf("\n C'= ");
        for (int i = 0; i < t; i++)
        {
            printf("%d  ", c[i]);
        }
    }
}
int main()
{
    printf("\n\t=================");
    nhap();
//    int x=p;
//    int P[50];
//    printf("\nma tran cuar P:");
//    bieudien(x,P);
    CongChinhXacBoi();
    tinh();
}
